{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모든 가게 목록(최신순)</title>
</head>
<body>
    <a href="{% url 'home:main'%}">홈</a>
    <br/>

    <h2>가게 목록</h2>

    <!-- 카테고리 필터 -->
    <form method="get">
        <select name="category" onchange="this.form.submit()">
            <option value="">전체</option>
            {% for category in categories %}
                <option value="{{ category.slug }}" {% if category.slug == selected_category %}selected{% endif %}>
                {{ category.name }}
            </option>
            {% endfor %}
        </select>
    </form>
    <br/>

    {% for store in stores %}
    <a href="{% url 'stores:store-detail' store.id %}">
        <div>
            {% if store.image %}
                <img src="{{ store.image.url }}" alt="{{ store.name }} 이미지" width="150" height="150">
                <br/>
            {% else %}
                <img src="{% static 'img/default_store.png' %}" alt="Default 이미지" width="150" height="150">
                <br/>
            {% endif %}

            <h3>{{ store.name }}</h3>

            <!-- 리뷰 목록 -->
            <a href="{% url 'reviews:review-list' store.id %}">
                <!-- 점수 -->
                ★ {{ store.rating|floatformat:1 }}
                <!-- 리뷰 개수-->
                ({{ store.reviews.count }}) 
            </a>
            <br/>

            주소: {{ store.address }}<br/>
            
            <!-- 거리 -->
            거리: {{ store.distance|default_if_none:"-"|floatformat:0 }} m
            <br/>

            카테고리:
            {% for category in store.category.all %}
            {{ category.name }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
            <br/>

            <!-- 영업 -->
            {% if store.open_time and store.close_time %}
                영업 시간: {{ store.open_time|time:"H:i" }} ~ {{ store.close_time|time:"H:i" }}
                {% if store.is_open %}
                    (영업 중)
                {% else %}
                    (영업 종료)
                {% endif %}
            {% endif %}

        </div>
    </a>
        <hr/>
    {% empty %}
        등록된 가게가 없습니다.
    {% endfor %}
</body>
</html>
