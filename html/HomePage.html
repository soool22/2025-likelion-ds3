{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>DDAL-LANG</title>
        <link rel="stylesheet" href="{% static 'css/HomePage.css'%}" />
    </head>
    <body>
        <main>
            {% if request.user.is_authenticated %}
            <header>
                <div id="headerBox">
                    <a href="{% url 'accounts:user_location' %}">
                        <div id="headerSmallBox">
                            <img id="locationIcon" src="{% static 'img/location.svg'%}"/>
                            {% if user_location and user_location.gu_name %}
                                <p id="locationName">{{ user_location.gu_name }}</p>
                            {% else %}
                                <p id="locationName">ÏúÑÏπò ÏÑ§Ï†ï</p>
                            {% endif %}
                            <img id="downSideClick" src="{% static 'img/downside.svg'%}"/>
                        </div>
                    </a>
                    <div id="headerLastBox">
                        <a href="{% url 'visit_rewards:my_character' %}">
                            <img id="characterIcon" src="{% static 'img/charactericon.svg'%}"/>
                        </a>
                        <a href="../html/AlarmCenterPage.html">
                            <img id="alarmIcon" src="{% static 'img/alarm.svg'%}"/>
                        </a>
                    </div>
                </div>
            </header>
            {% if if user_location and user_location.gu_name %}
            <div id="container">
                <div id="banner">
                    <div id="bannerBox">
                        <p id="bannerTitle">7Ïõî ÎèôÎÑ§ Ïù∏Í∏∞ ÎßõÏßë<br/>ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å</p>
                        <p id="bannerContent">Ïù¥Ïö©ÏûêÎì§Ïù¥ Í∞ÄÏû• ÎßéÏù¥ Ïû¨Î∞©Î¨∏Ìïú <br/>Ïù∏Í∏∞ ÎßõÏßëÏùÑ ÌôïÏù∏Ìï¥ Î≥¥ÏÑ∏Ïöî!</p>
                    </div>
                    <img id="bannerCharacter" src="{% static 'img/characterBell.svg'%}"/>
                </div>
                <form>
                    <div class="tabContainer">
                        <div class="recommendstoreBox">
                            <img class="recommendstoreIcon" src="{% static 'img/recommendstore.svg'%}" alt="">
                            <p class="recommendstoreText">Ï∂îÏ≤ú Í∞ÄÍ≤å</p>
                        </div>
                        <div class="topBox">
                            <img class="topIcon" src="{% static 'img/top.svg'%}" alt="">
                            <p class="topText">Ïò§ÎäòÏùò HOT</p>
                        </div>
                        <div class="reviewbestBox">
                            <img class="reviewbestIcon" src="{% static 'img/reviewbest.svg'%}" alt="">
                            <p class="reviewbestText">Î¶¨Î∑∞ BEST</p>
                        </div>
                    </div>
                </form>
                <form>
                    <div id="storeContainer">
                        {% comment %} Ï∂îÏ≤ú {% endcomment %}
                        <div class="storeCardBox" id="storeCardBox-recommend" >
                            {% if recommended_stores %}
                            {% for store in recommended_stores %}
                            <a href="{% url 'stores:store-detail' store.id %}">
                                <div class="storeCard">
                                    <img class="storeImg" src="{% static 'img/default_store.png'%}"/>
                                    <div class="storeInfoBox">
                                        <div class="storeInfoMediumBox">
                                            <div class="storeInfoSmallBox">
                                                <p class="storeCategory">{% for c in store.category.all %}{{ c.name }}{% if not forloop.last %},{% endif %}{% endfor %}</p>
                                                <p class="storeName">{{ store.name }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="commentBox">
                                        <div class="distanceTimeBox">
                                            <div class="distanceTime">
                                                {% if store.distance %}
                                                <p class="distanceTimeContent">{{ store.distance }}</p>
                                                {% else %}
                                                    <p class="distanceTimeContent">Í±∞Î¶¨ Ï†ïÎ≥¥ ÏóÜÏùå</p>
                                                {% endif %}
                                            </div>
                                            <div class="distanceTime">
                                                {% if store.open_time and store.close_time %}
                                                <p class="distanceTimeContent"style="color: #0094D6;">{% if store.is_open %}(ÏòÅÏóÖ Ï§ë){% else %}(ÏòÅÏóÖ Ï¢ÖÎ£å){% endif %}</p>
                                                {% else %}
                                                    <p class="distanceTimeContent"style="color: #0094D6;">ÏòÅÏóÖÏãúÍ∞Ñ ÎØ∏Ï†ï</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                            {% else %}
                                <p>Ï∂îÏ≤ú Í∞ÄÍ≤åÎ•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
                            {% endif %}
                        </div>
                        
                        {% comment %} top100 {% endcomment %}
                        <div class="storeCardBox" id="storeCardBox-top" >
                            {% for store in top_visits %}
                            <a href="{% url 'stores:store-detail' store.id %}">
                                <div class="storeCard">
                                    <img class="storeImg" src="{% static 'img/default_store.png'%}"/>
                                    <div class="storeInfoBox">
                                        <div class="storeInfoMediumBox">
                                            <div class="storeInfoSmallBox">
                                                <p class="storeCategory">{% for c in store.category.all %}{{ c.name }}{% if not forloop.last %},{% endif %}{% endfor %}</p>
                                                <p class="storeName">{{ store.name }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="commentBox">
                                        <div class="distanceTimeBox">
                                            <div class="distanceTime">
                                                {% if store.distance %}
                                                <p class="distanceTimeContent">{{ store.distance }}</p>
                                                {% else %}
                                                    <p class="distanceTimeContent">Í±∞Î¶¨ Ï†ïÎ≥¥ ÏóÜÏùå</p>
                                                {% endif %}
                                            </div>
                                            <div class="distanceTime">
                                                {% if store.open_time and store.close_time %}
                                                <p class="distanceTimeContent"style="color: #0094D6;">{% if store.is_open %}(ÏòÅÏóÖ Ï§ë){% else %}(ÏòÅÏóÖ Ï¢ÖÎ£å){% endif %}</p>
                                                {% else %}
                                                    <p class="distanceTimeContent"style="color: #0094D6;">ÏòÅÏóÖÏãúÍ∞Ñ ÎØ∏Ï†ï</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        {% comment %} Î¶¨Î∑∞best {% endcomment %}
                        <div class="storeCardBox" id="storeCardBox-review">
                            {% for store in review_best %}
                            <a href="{% url 'stores:store-detail' store.id %}">
                                <div class="storeCard">
                                    <img class="storeImg" src="{% static 'img/default_store.png'%}"/>
                                    <div class="storeInfoBox">
                                        <div class="storeInfoMediumBox">
                                            <div class="storeInfoSmallBox">
                                                <p class="storeCategory">{% for c in store.category.all %}{{ c.name }}{% if not forloop.last %},{% endif %}{% endfor %}</p>
                                                <p class="storeName">{{ store.name }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="commentBox">
                                        <div class="distanceTimeBox">
                                            <div class="distanceTime">
                                                {% if store.distance %}
                                                <p class="distanceTimeContent">{{ store.distance }}</p>
                                                {% else %}
                                                    <p class="distanceTimeContent">Í±∞Î¶¨ Ï†ïÎ≥¥ ÏóÜÏùå</p>
                                                {% endif %}
                                            </div>
                                            <div class="distanceTime">
                                                {% if store.open_time and store.close_time %}
                                                <p class="distanceTimeContent"style="color: #0094D6;">{% if store.is_open %}(ÏòÅÏóÖ Ï§ë){% else %}(ÏòÅÏóÖ Ï¢ÖÎ£å){% endif %}</p>
                                                {% else %}
                                                    <p class="distanceTimeContent"style="color: #0094D6;">ÏòÅÏóÖÏãúÍ∞Ñ ÎØ∏Ï†ï</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        <div id="btnBox">
                            <a href="{% url 'stores:store-search' %}">
                                <div id="mapBtn">
                                    <div id="mapBtnBox">
                                        <img id="mapIcon" src="{% static 'img/map.svg'%}"/>
                                        <p id="mapTitle">ÏßÄÎèÑÎ°ú Î≥¥Í∏∞</p>
                                    </div>
                                </div>
                            </a>
                            <a href="">
                                <div id="plusBtn">
                                    <div id="plusBtnBox">
                                        <img id="plusIcon" src="{% static 'img/plus.svg'%}"/>
                                        <p id="plusTitle">ÎçîÎ≥¥Í∏∞</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div id="challengeBox">
                            <a href="{% url 'missions:my-mission' %}">
                                <p id="challengeTitle">üî• Ï£ºÍ∞Ñ Ïù∏Í∏∞ Ï±åÎ¶∞ÏßÄ</p>
                            </a>
                            <div id="challengeRanking">
                                {% if rankings %}
                                    {% for r in rankings %}
                                        <a href="{% url 'stores:store-detail' r.mission.store.id %}">
                                            <p class="challenge">[{{ r.mission.store.name }}] {{ r.mission.title }} ‚ñ∂ Ï∞∏Ïó¨Ïûê {{ r.participant_count }}Î™Ö</p>
                                        </a>
                                    {% endfor %}
                                {% else %}
                                    <p class="challenge">Ïò§ÎäòÏùò Ïù∏Í∏∞ Ï±åÎ¶∞ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            {% endif %}
            <div id="tapBar">
                <a class="tapBarBox" href="{% url 'home:main'%}">
                    <img class="tapBarIcon" src="{% static 'img/homepicked.svg'%}" alt="Ìôà ÏÑ†ÌÉù ÏïÑÏù¥ÏΩò" />
                    <p class="tapBarLabel picked">Ìôà</p>
                </a>
                <a class="tapBarBox" href="{% url 'stores:store-search' %}">
                    <img class="tapBarIcon" src="{% static 'img/search.svg'%}" alt="Í∞ÄÍ≤å Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò" />
                    <p class="tapBarLabel">Í∞ÄÍ≤å Í≤ÄÏÉâ</p>
                </a>
                <a class="tapBarBox" href="{% url 'accounts:favorite_stores' %}">
                    <img class="tapBarIcon" src="{% static 'img/intereststore.svg'%}" alt="Í¥ÄÏã¨ Îß§Ïû• ÏïÑÏù¥ÏΩò" />
                    <p class="tapBarLabel">Í¥ÄÏã¨ Îß§Ïû•</p>
                </a>
                <a class="tapBarBox" href="{% url 'accounts:mypage' %}">
                    <img class="tapBarIcon" src="{% static 'img/myinfo.svg'%}" alt="ÎÇ¥ Ï†ïÎ≥¥ ÏïÑÏù¥ÏΩò" />
                    <p class="tapBarLabel">ÎÇ¥ Ï†ïÎ≥¥</p>
                </a>
            </div>
            {% else %}
                <a href="{% url 'accounts:login' %}">Î°úÍ∑∏Ïù∏</a>
                <a href="{% url 'accounts:signup' %}">ÌöåÏõêÍ∞ÄÏûÖ</a>
            {% endif %}
        </main>
        <script>
        (() => {
        const tabs = document.querySelectorAll(
            '.recommendstoreBox, .topBox, .reviewbestBox'
        );
        if (!tabs.length) return;

        const plusLink = document.getElementById('plusBtn')?.closest('a');

        const ROUTES = {
            recommend: '{% url 'stores:public-store-list' %}',
            top: '{% url 'stores:popular-store-list' %}',
            review: '{% url 'stores:review-best-list' %}',
        };

        // Î∞ïÏä§ 3Í∞úÎ•º ÏàúÏÑúÎåÄÎ°ú Ïû°Ïùå: [Ï∂îÏ≤ú, top, review]
        const boxes = document.querySelectorAll('#storeContainer .storeCardBox');
        const KEYS  = ['recommend', 'top', 'review'];
        const BOXES = {};
        boxes.forEach((box, i) => { BOXES[KEYS[i]] = box; });

        function tabKey(el) {
            if (el.classList.contains('recommendstoreBox')) return 'recommend';
            if (el.classList.contains('topBox'))           return 'top';
            return 'review';
        }

        function showBox(key) {
            Object.entries(BOXES).forEach(([k, el]) => {
            if (!el) return;
            el.style.display = (k === key) ? '' : 'none';
            el.hidden = (k !== key);
            el.setAttribute('aria-hidden', String(k !== key));
            });
        }

        function setActiveTab(selected) {
            tabs.forEach(tab => {
            tab.classList.remove('active');
            const img = tab.querySelector('img');
            if (img) img.src = img.src.replace('picked', '');
            });

            selected.classList.add('active');
            const icon = selected.querySelector('img');
            if (icon && !/picked\.svg$/.test(icon.src)) {
            icon.src = icon.src.replace('.svg', 'picked.svg');
            }

            const key = tabKey(selected);
            showBox(key);

            if (plusLink) plusLink.href = ROUTES[key] || '#';
        }

        // Ï¥àÍ∏∞: Ï≤´ ÌÉ≠
        setActiveTab(tabs[0]);

        tabs.forEach(tab => tab.addEventListener('click', () => setActiveTab(tab)));
        })();
        </script>
    </body>
    <script src="{% static 'js/HomePage.js'%}"></script>
</html>