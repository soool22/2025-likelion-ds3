{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDAL-LANG</title>
    <link rel="stylesheet" href="{% static 'css/MyReview.css'%}" />    
</head>
<body>
    <main>
        <header>
            <a href="{% url 'home:main' %}">
                <img src="{% static 'img/edit-back.png'%}" class="back-img"></img>
            </a>
            <div class="tittle text"> 내 리뷰 관리 </div>
        </header>
        <div class="separation-box"></div>
        {% if reviews %}
            {% for review in reviews %}
            <div class="review-box">
                <a href="{% url 'stores:store-detail' review.store.id %}">
                    <div class="store-name text">{{ review.store.name }}</div>
                </a>
                <div class="second-line">
                    <div class="review-star">
                        {{ review.stars }}
                    </div>
                    <div class="date text">{{ review.created_at|date:"Y-m-d" }}({{ review.natural_days }})</div>
                </div>
                <div class="short-review text">{{ review.comment|linebreaks }}</div>
                <!--이미지-->
                <div class="review-images">
                        {% for img in review.images.all %}
                            {% if img.image %}
                                <a href="{{ img.image.url }}" target="_blank">
                                    <img src="{{ img.image.url }}" alt="리뷰 이미지" width="150" height="150">
                                </a>
                            {% endif %}
                        {% endfor %}
                    </div>

                <div class="fourth-line">
                    {% if review.likes.count > 0 %}
                        <div class="recommend-num">{{ review.likes.count }}명이 추천해요</div>
                    {% endif %}
                    <div style="display: flex; align-items: center;">
                        <div class="delete-box">
                        <img src="{% static 'img/delete.png'%}">
                        <div class="delete text">
                            <a class="delete text" href="{% url 'reviews:review-delete' review.id %}">삭제</a>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="store-name text" style="text-align:center; margin-top:3px;">아직 작성한 리뷰가 없습니다.</div>
        {% endif %}
    </main>
</body>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const filledSrc = "{% static 'img/starpicked.svg' %}"; // 채운 별
  const MAX = 5;

  document.querySelectorAll('.review-star').forEach(el => {
    const raw = (el.textContent || '').trim();

    // 1) "★★★★☆" 같은 문자열이면 ★ 개수 세기
    let filled = (raw.match(/★/g) || []).length;

    // 2) 만약 숫자라면 숫자로 처리 (예: "4")
    if (!filled && /^\d+$/.test(raw)) {
      filled = parseInt(raw, 10) || 0;
    }

    filled = Math.max(0, Math.min(MAX, filled));
    const empty = MAX - filled;

    // 이미지로 교체
    const frag = document.createDocumentFragment();
    for (let i = 0; i < filled; i++) {
      const img = document.createElement('img');
      img.src = filledSrc;
      img.alt = '★';
      frag.appendChild(img);
    }
    

    el.textContent = '';   // 기존 ★ 텍스트 지우기
    el.appendChild(frag);  // 이미지 삽입
  });
});
</script>
</html>